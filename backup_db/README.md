# Домашнее задание к занятию "Резервное копирование баз данных" - `Zubkov Danil`

### Задание 1
Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.

Необходимо описать, какие варианты резервного копирования подходят в случаях:

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

### Решение 1
1.1. В данном случае можно использовать классический вариант с полным резервным копированием раз в день - это значительно увеличит надежность БД.<br>
Но также можно комбинировать использование full backup и incremental backup(например в начале недели делать полный бэкап, а каждый следующий день использовать инкрементное резервное копирование) - это увелит как надежность, так и скорость резервного копирования.

1.2. В случае, когда "*необходимо восстанавливать данные за час до предполагаемой поломки*", необходимо делать backup каждый час.
- Конечно можно использовать full backup каждый час, но в данном случае это будет не совсем удобно и практично, если БД большая.
- Можно также использовать вариант с комбинацией full backup и incremental backup - делать полный бэкап раз в день, а каждый час использовать инкрементное резервное копирование.


### Задание 2
2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

### Решение 2

Команда резервирования данных:
```
pg_dump имя_базы > файл_дампа
```
Также при необходимости можно искользовать параметры:

-U - указать имя пользователя, если БД принадлежит другому пользователю<br>
-n, -t - можно указать название схемы или таблицы, резервную копию которой мы хотим сделать<br>
-Fc - использование другого формата дампа<br>

Команда восстановления БД:
```
psql -X имя_базы < файл_дампа
```


### Задание 3
С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.

### Решение 3
В MySQL нет встроенной команды для инкрементного резервного копирования, как в некоторых других системах. Обычно для этого используют инструменты, такие как:
- mysqldump
- mysqlbackup<br>

**С использованием mysqldump**<br>
Для полного резервного копирования используется команда:
```
mysqldump -u [user] -p --all-databases > full_backup.sql
```
Для инкрементного резервного копирования обычно используют бинарные логи. Например, чтобы сделать инкрементный бэкап, сначала включают бинарные логи, а затем копируют только новые транзакции, записанные после последнего бэкапа.<br>
Пример команды для копирования бинарных логов (после полного бэкапа):
```
mysqlbinlog --read-from-remote-server --stop-position=[position] mysql-bin.000001 > incremental_backup.sql
```


**С использованием mysqlbackup**<br>
В MySQL Enterprise версии инкрементное резервное копирование можно реализовать с помощью встроенных утилит и функций.<br>
Например:
```
mysqlbackup --defaults-file=/home/dbadmin/my.cnf \
  --incremental --incremental-base=history:last_backup \
  --backup-dir=/home/dbadmin/temp_dir \
  --backup-image=incremental_image1.bi \
   backup-to-image
```
Используется опция --incremental-base=history:last_backup , с помощью которой mysqlbackup извлекает LSN последней успешной (не TTS) полной или частичной резервной копии из таблицы mysql.backup_history и на его основе выполняет инкрементное резервное копирование.
